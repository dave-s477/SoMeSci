Mathematical model of a rational decision: To model the decision-making process of bacteriophages in E. coli, we first show how the environmental state can be estimated based on the internal information of phages such as  and size of the host bacterium. Then we present a method to determine the utility of each action and its corresponding probability based on the environmental state. A phage inside E. coli senses the size and the multiplicity of infection by probing the concentration of proteins and the concentration of dimers such as  and  inside the host bacterium [33], [34]. Therefore, in our model, size and  of the host bacterium are considered as internal signals. Let the random variable  be the average  within a population of phages and bacteria, where the average  is the total number of phages infecting a bacterium over the total number of bacteria in the environment. Also let  be the  of a host bacterium with size , and  be the number of phages inside the host bacteria. A bacterium with size  is a bacterium which its volume is  times the average volume of all bacteria in the environment A rational player infers about the average  and defines posterior probability  based on the Bayes rule:(1) To compute the posterior probability, we estimate the value of , , and . Consider an environment with average   in which phages move and infect bacteria randomly. The infection process can be seen as a Poisson process with average rate  [36]. The Poisson distribution is a probability distribution that expresses the probability of a given number of events that occur in a fixed interval of time and/or space when the events occur with a known average rate [40]. On the other hand, the bacterium infection by phages is a random process, with an average number of infections , which is independent of previous infections. Hence, the probability distribution of  for a single bacterium of size , given the average  , can be expressed by a Poisson distribution:(2) For prior probability  we assign a uniform distribution between  and , i.e.,  for . The above simple distribution enjoys the maximum entropy and equivalently the minimum knowledge among all priors. Uniform distribution is the most rational assumption when there is no prior information on the parameter [41], [42]. At the end, probability  can be obtained by marginalizing out  as follows:(3) Now, probability  can be calculated based on equations 1, 2, and 3 as follows:(4) From the definition of gamma function, we have , where  for a positive integer  [43]. There is also a nice bound for the value of  as follows:(5) Equation 5 shows that  is a good estimation for . Putting all these facts together, we have:(6)(7) The lysis action increases the number of phages and kills the host bacterium. The lysogeny action only takes care of the host bacterium. Therefore, decision making in E. coli depends on the average . It means if the number of phages in the environment is high and there are not enough host bacteria, a rational player takes care of host bacterium and lysogenize. Otherwise, a rational player tends to lyse. The utility function is modeled with a threshold . The utility of lysis overcomes the utility of lysogeny if and only if a rational player infers that the average  is less than . To simplify the model, we look at the environmental state as a result of individual's strategies and define the utility functions based on the environmental state. We demonstrate the utility of individual  by function . Note that individual's strategies affect the state of the environment in the future. Thus, in our model the utility function implicitly depends on other individual's strategies. Let  be the utility of action  of individual  when the environmental state, average , is . Let's assume the set of all possible actions is . The utility of lysis should drop at threshold point  and the utility of lysogeny should rise at the same threshold point. This means the phages tend to keep the average  around  which is their desired average . We focus on the sigmoid function and define the utility functions as follows:(8)(9) where  is a threshold point and phages are more likely to choose lysogenic pathway when their estimation about the average  exceeds threshold  and  is a parameter that defines the slope of the sigmoid function. Note that phages only detect internal signals, e.g.,  and size of the host bacterium and thus they need an estimation about the utility of each action based on the observed internal signals rather than the average . This is done by inferring about the average  based on the internal signals. Therefore, the expected utility of action  for a phage with host bacterium   and host bacterium size , , is defined by integrating over all possible environmental average s as follows:(10) There are several rules in the population games and evolutionary dynamics that determine the strategy of players based on their utility. We employ the noisy best-response rule, the logit-response rule, as a well-known rule in the discrete choice literature for environmental evolution that well matches our setting [44]–[47]. In the logit-response rule, every individual plays its best-response strategy with a probability close to 1. However, we allow a small possibility for making mistakes. Individuals might make mistakes in their inferences if their information about their surroundings are noisy or the agents are not entirely rational [44], [48]–[51]. In the logit-response rule the probability that individual  takes action , , is proportional to  as follows:(11)where  determines how noisy the system is. shows that the system is noise-free and every individual plays its best action and  represents a full noisy environment in which every individual plays randomly. A value between these two extreme points is chosen for modeling the behavior of real-world decision makers [44], [48]–[51].

Mathematical model of a gene regulatory network: The gene regulatory networks are mathematically represented in many different ways, including Boolean networks [52], Bayesian networks [53], ordinary differential equations (ODEs) [22], hybrid models [54], and even game theory [55]. Among all, we selected ODEs since they represent the dynamical states of small networks more precisely along the time. The ordinary differential equations (ODEs) reported by [22] are used as a basis for the computational study of the lysis/lysogeny decision making at a molecular resolution. A non-restrictive quasi-steady state approximation (QSSA) method is applied to reduce the number of equations based on the great difference in the rate of fast (binding and unbinding of proteins) versus slow reactions (transcription, translation and protein degradation):(12) Here  stands for multiplicity of infection (),  and  are the rescaled concentrations of  and  free monomers,  is transcriptional rate of  when the promoter is bound,  is the transcriptional rate of  when the promoter is unbound, and  and  are degradation rates for  and  proteins respectively. More details about equations and parameters are provided in the supplementing information. We model equation set 12 as a two-dimensional sample space, the force-field representation of which is provided in 5. Since this force-field representation is not a gradient vector fields, it is not possible to find an exact potential function for it. Therefore, we use a computationally feasible pseudo-potential function, only for a graphical representation of the landscape of the gene regulatory network. This potential function is monotonically increasing while it goes from an attractor center out to transient states (Figure 5). The logarithmic scale enables us to track the precise position of the attractor points. A pseudo-potential function is defined as follows:(13) Here  is a small positive value ensures that the logarithm function is computed for positive values. This equation assigns the minimum potential  to all attractor states where  and  are zero. In theory, a similar potential function is assigned to unstable fixed points. However the vector-space representations of the force fields show such points are not present in our experiments (Figure 5, A–C).

